<div class="container mt-5 p-4 rounded shadow bg-light text-center" style="max-width: 800px;"
    [ngClass]="{'dark': temaEscuro}">
    <h2 class="text-primary mb-4 d-flex justify-content-between align-items-center">
        Lembrete de Água 💧
        <div>
            <button class="btn btn-sm btn-outline-secondary me-2"
                (click)="mostrarConfiguracoes = !mostrarConfiguracoes">
                ⚙️
            </button>
            <button *ngIf="notificacaoAtiva" class="btn btn-sm btn-warning me-2" (click)="cancelarLembretes()">
                🔕 Desativar lembretes
            </button>
            <button *ngIf="!notificacaoAtiva" class="btn btn-sm btn-success me-2" (click)="reativarLembretes()">
                🔔 Ativar lembretes
            </button>
            <button class="btn btn-sm btn-outline-secondary" (click)="toggleTema()">
                {{ temaEscuro ? '🌞 Claro' : '🌙 Escuro' }}
            </button>
        </div>
    </h2>

    <!-- Formulário de configuração -->
    <div *ngIf="!configurado">
        <form (ngSubmit)="configurarMeta()">
            <div class="mb-3">
                <label class="form-label">Peso (kg)</label>
                <input type="number" class="form-control" [(ngModel)]="peso" name="peso" required />
            </div>
            <div class="mb-3">
                <label class="form-label">Idade</label>
                <input type="number" class="form-control" [(ngModel)]="idade" name="idade" required />
            </div>
            <div class="form-check mb-3">
                <input type="checkbox" class="form-check-input" [(ngModel)]="atividade" name="atividade" />
                <label class="form-check-label">Pratico atividade física regularmente</label>
            </div>
            <button type="submit" class="btn btn-success w-100">Calcular Meta de Água</button>
        </form>
    </div>

    <!-- Área principal após configurar -->
    <div *ngIf="configurado" class="text-center">

        <!-- Exibição principal de consumo e botões -->
        <div *ngIf="!mostrarConfiguracoes">
            <div class="progress mb-3" style="height: 30px;">
                <div class="progress-bar bg-info" role="progressbar" [style.width.%]="porcentagem"
                    attr.aria-valuenow="{{ porcentagem }}" aria-valuemin="0" aria-valuemax="100">
                    {{ porcentagem | number : '1.0-0' }}%
                </div>
            </div>

            <p>Você já bebeu <strong>{{ quantidadeBebida }} ml</strong> de água hoje.</p>
            <p>Faltam <strong>{{ restante }} ml</strong> para bater a meta diária de {{ metaDiaria }} ml.</p>

            <div class="btn-group mt-3 mb-3 flex-wrap" role="group">
                <button *ngFor="let vol of customVolumes" class="btn btn-primary m-1" (click)="adicionarAgua(vol)">
                    +{{ vol }} ml
                </button>
            </div>

            <div class="btn-group mt-3 mb-3 flex-wrap" role="group">
                <button *ngFor="let vol of customVolumes" class="btn btn-outline-danger m-1" (click)="removerAgua(vol)">
                    -{{ vol }} ml
                </button>
            </div>

            <!-- Histórico semanal -->
            <h4 class="mt-4">Histórico da última semana</h4>
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Quantidade (ml)</th>
                        <th>Percentual da meta</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let dia of historico">
                        <td>{{ dia.data }}</td>
                        <td>{{ dia.quantidade }}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar" role="progressbar"
                                    [style.width.%]="(dia.quantidade / metaDiaria) * 100"
                                    [attr.aria-valuenow]="(dia.quantidade / metaDiaria) * 100" aria-valuemin="0"
                                    aria-valuemax="100"></div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="footer-btns">
                <button class="btn btn-danger mt-3" (click)="resetarQuantidade()">Resetar quantidade de água
                    bebida</button>
            </div>
        </div>

        <!-- Configurações customizadas -->
        <div *ngIf="mostrarConfiguracoes">
            <div class="mb-3">
                <label class="form-label">Personalizar volumes (ml, separados por vírgula)</label>
                <input type="text" class="form-control" [value]="customVolumes.join(', ')"
                    (change)="atualizarVolumes($event)" />
            </div>

            <div class="mb-3">
                <label class="form-label">Tempo entre lembretes (minutos)</label>
                <input type="number" class="form-control" [(ngModel)]="intervaloMinutos" name="intervaloMinutos" min="1"
                    (ngModelChange)="atualizarIntervalo($event)" />
            </div>

            <button class="btn btn-outline-secondary w-100" (click)="configurado = false">
                Reconfigurar Dados de Meta Diária
            </button>
        </div>
    </div>
</div>